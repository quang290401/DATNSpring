<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <title>Hóa Đơn Thanh Toán</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .invoice-container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .invoice-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .invoice-header h1 {
            margin: 0;
            font-size: 24px;
        }

        .invoice-header p {
            margin: 5px 0;
            color: #666;
        }

        .invoice-details, .customer-details {
            margin-bottom: 20px;
        }

        .invoice-details table, .customer-details table, .invoice-items table {
            width: 100%;
            border-collapse: collapse;
        }

        .invoice-details th, .invoice-details td, .customer-details th, .customer-details td, .invoice-items th, .invoice-items td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .invoice-items th {
            background-color: #f4f4f4;
        }

        .total-row {
            font-weight: bold;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }
    </style>
</head>
<body>
<div th:replace="web/common/header.html"></div>
<div class="invoice-container">
    <div class="customer-details">
        <h2>Thông Tin Khách Hàng</h2>
        <table>
            <tr>
                <th>Họ Tên</th>
                <td th:text="${session.user.ho+' '+session.user.tenDem+' '+session.user.ten}"></td>
            </tr>
            <tr>
                <th>Địa Chỉ</th>
                <td th:text="${session.user.diaChi.quocGia+' '+session.user.diaChi.thanhPho+' '+session.user.diaChi.diaChi}"></td>
            </tr>
            <tr>
                <th>Điện Thoại</th>
                <td th:text="${session.user.sdt}"></td>
            </tr>
        </table>
    </div>
    <input type="hidden" class="form-control" id="user" name="user" th:value="${session.user.id}"/>
    <div class="invoice-items">
        <h2>Danh Sách Sản Phẩm</h2>
        <table>
            <thead>
            <tr>
                <th>Tên Sản Phẩm</th>
                <th>Số Lượng</th>
                <th>Đơn Giá</th>
                <th>Thành Tiền</th>
            </tr>
            </thead>
            <tbody id="product-list">
            <!-- Products will be loaded here by JavaScript -->
            </tbody>
        </table>
    </div>
    <div class="footer">
        <p>Cảm ơn quý khách đã mua hàng!</p>
    </div>
</div>

<script>
    $(document).ready(function() {
        var id = $('#user').val();
        console.log("User ID: " + id); // Kiểm tra giá trị của id

        // Gọi API để lấy danh sách sản phẩm
        $.ajax({
            url: '/api/HDCT/' + id,
            method: 'GET',
            success: function(data) {
                var productList = $('#product-list');
                productList.empty();

                var totalAmount = 0;

                data.forEach(function(item) {
                    var row = $('<tr></tr>');
                    row.append('<td>' + item.sanPhamChiTiet.sanPham.tenSanPham + '</td>');
                    row.append('<td>' + item.soLuong + '</td>');
                    row.append('<td>' + item.sanPhamChiTiet.giaSanPham + ' VND</td>');
                    row.append('<td>' + item.thanhTien + ' VND</td>');

                    totalAmount += item.thanhTien;
                    productList.append(row);
                });

                var totalRow = $('<tr class="total-row"></tr>');
                totalRow.append('<td colspan="3">Tổng Cộng</td>');
                totalRow.append('<td>' + totalAmount + ' VND</td>');
                productList.append(totalRow);
            },
            error: function(error) {
                console.error('Lỗi khi gọi API', error);
            }
        });
    });

</script>
</body>
</html>