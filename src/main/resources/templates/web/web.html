<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title>Shop Homepage - Start Bootstrap Template</title>
  <!-- Favicon-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</head>
<body>
<div th:replace="web/common/header.html"></div>
<section class="py-5">
  <div class="container px-4 px-lg-5 mt-5">
    <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
      <!-- Sản phẩm sẽ được thêm vào đây bởi AJAX -->
    </div>
  </div>
</section>
<div th:replace="web/common/foodter.html"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/dist/addjs/scripts.js}"></script>
<script th:src="@{/dist/css/styles.css}"></script>
<script th:src="@{/dist/assets/favicon.ico}"></script>

</body>
<script >
  $(document).ready(function() {
    $.ajax({
      url: '/api/SPCT', // URL của API của bạn
      method: 'GET',
      dataType: 'json',
      success: function(response) {
        console.log('Data received from API:', response); // Kiểm tra dữ liệu nhận được
        var container = $('.row-cols-2.row-cols-md-3.row-cols-xl-4.justify-content-center');
        container.empty(); // Xóa nội dung cũ

        // Lấy mảng sản phẩm từ dữ liệu nhận được
        var products = response.content;

        // Kiểm tra nếu products là một mảng
        if (Array.isArray(products)) {
          products.forEach(function(product) { // Sửa tên biến thành product
            var productId = product.id; // Lấy id của sản phẩm
            var productHtml = `
            <div class="col mb-5">
              <div class="card h-100">
                <!-- Product image-->
                <img class="card-img-top" src="${product.hinhAnh.duongDan}" alt="...">
                <!-- Product details-->
                <div class="card-body p-4">
                  <div class="text-center">
                    <!-- Product name-->
                    <h5 class="fw-bolder">${product.sanPham.tenSanPham}</h5>
                    <!-- Product price-->
                    ${product.giaSanPham.toLocaleString('vi-VN', {style: 'currency', currency: 'VND'})}
                  </div>
                </div>
                <!-- Product actions-->
                <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                  <div class="text-center"><a class="btn btn-outline-dark mt-auto view-options" href="#" data-product-id="${productId}">View options</a></div>
                </div>
              </div>
            </div>
          `;

            container.append(productHtml);
          });
        } else {
          console.error('Expected an array but got:', products);
          container.append('<p class="text-danger">Error: Expected an array but got invalid data format.</p>');
        }
      },
      error: function(err) {
        console.error('Error fetching products:', err);
        var container = $('.row-cols-2.row-cols-md-3.row-cols-xl-4.justify-content-center');
        container.empty(); // Xóa nội dung cũ
        container.append('<p class="text-danger">Error fetching products. Please try again later.</p>');
      }
    });

    // Bắt sự kiện click vào liên kết
    $(document).on('click', '.view-options', function(e) {
      e.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ <a>

      var productId = $(this).data('product-id'); // Lấy id từ thuộc tính data

      // Chuyển hướng đến trang chi tiết sản phẩm
      window.location.href = '/DetailSP/' + productId;
    });
  });


</script>


</html>
